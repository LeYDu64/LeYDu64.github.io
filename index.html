<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#1a120b">
<title>L'Imposteur du Royaume</title>

<style>
body{
    margin:0;
    font-family: 'Georgia', serif;
    color:#f5deb3;
    text-align:center;
    background: radial-gradient(circle at top,#3b2a1d,#1a120b 60%);
}

.container{
    max-width:520px;
    margin:auto;
    padding:20px;
}

.logo{
    font-size:32px;
    font-weight:bold;
    color:gold;
    text-shadow:0 0 10px gold,0 0 20px #ffae00;
}

.card{
    background:linear-gradient(145deg,#2b1d13,#1a120b);
    padding:20px;
    margin-top:20px;
    border-radius:18px;
    box-shadow:0 0 25px rgba(255,215,0,0.2);
    border:1px solid rgba(255,215,0,0.2);
    animation:fadeIn 0.5s ease;
}

@keyframes fadeIn{
    from{opacity:0;transform:translateY(15px);}
    to{opacity:1;transform:translateY(0);}
}

input{
    padding:10px;
    margin:6px;
    border-radius:8px;
    border:1px solid #b8860b;
    background:#1a120b;
    color:#f5deb3;
}

button{
    background:linear-gradient(145deg,#b8860b,#8b6508);
    border:none;
    padding:12px;
    margin:8px 0;
    width:100%;
    font-size:16px;
    border-radius:10px;
    color:white;
    cursor:pointer;
    font-weight:bold;
    box-shadow:0 0 10px rgba(255,215,0,0.4);
}

button:hover{
    background:linear-gradient(145deg,#d4af37,#a67c00);
}

.playerButton{
    background:linear-gradient(145deg,#5a3e2b,#3b2a1d);
}

.ruleBtn{background:#3e6b48;}
.resetBtn{background:#6b2c2c;}

.hidden{display:none;}
</style>
</head>

<body>

<div class="container">
<div class="logo">üëë L'Imposteur du Royaume</div>

<div id="setup" class="card">
<h3>‚öî Configuration</h3>
<input type="number" id="playerCount" min="4" placeholder="Nombre de joueurs">
<input type="number" id="impostorCount" min="1" placeholder="Nombre d'imposteurs">
<label><input type="checkbox" id="idiotToggle"> Ajouter un Idiot du Royaume</label>
<div id="nameInputs"></div>
<button onclick="generateNameInputs()">Valider joueurs</button>
<button onclick="startGame()">Lancer la partie</button>
<button class="ruleBtn" onclick="toggleRules()">R√®gles</button>
<button class="resetBtn" onclick="resetData()">R√©initialiser</button>
</div>

<div id="rules" class="card hidden">
<h3>üìú R√¥les</h3>
<p>
üë®‚Äçüåæ <b>Villageois</b> : Ont le m√™me mot.<br><br>
üïµÔ∏è <b>Imposteur</b> : Ont un mot diff√©rent.<br><br>
ü§° <b>Idiot du Royaume</b> : N'a aucun mot et tente de le deviner √† son √©limination.
</p>
</div>

<div id="transition" class="card hidden">
<h3>Passe le t√©l√©phone √†</h3>
<h2 id="playerName"></h2>
<button onclick="showWord()">Voir mon r√¥le</button>
</div>

<div id="reveal" class="card hidden">
<h2 id="wordText"></h2>
<button onclick="nextPlayer()">Cacher</button>
</div>

<div id="voteScreen" class="card hidden">
<h3>Votez un joueur</h3>
<div id="voteButtons"></div>
</div>

<div id="resultScreen" class="card hidden"></div>

</div>

<script>

let players=[];
let currentPlayer=0;
let villageWord="";
let impostorWord="";

const words=[
["Chat","Tigre"],["Pizza","Burger"],
["Roi","Prince"],["Dragon","Dinosaure"],
["Plage","Piscine"],["Soleil","Lune"],
["Football","Basket"],["Vin","Bi√®re"]
];

/* ===============================
   SAUVEGARDE CONFIGURATION
================================= */

function saveConfig(){
    const config={
        playerCount:playerCount.value,
        impostorCount:impostorCount.value,
        idiot:idiotToggle.checked,
        names:getNames()
    };
    localStorage.setItem("royaumeConfig",JSON.stringify(config));
}

function loadConfig(){
    const saved=JSON.parse(localStorage.getItem("royaumeConfig"));
    if(!saved) return;

    playerCount.value=saved.playerCount;
    impostorCount.value=saved.impostorCount;
    idiotToggle.checked=saved.idiot;

    generateNameInputs();

    setTimeout(()=>{
        saved.names.forEach((name,i)=>{
            const input=document.getElementById("name"+i);
            if(input) input.value=name;
        });
    },100);
}

function resetData(){
    localStorage.removeItem("royaumeConfig");
    location.reload();
}

/* ===============================
   LOGIQUE JEU
================================= */

function shuffle(array){
    for(let i=array.length-1;i>0;i--){
        let j=Math.floor(Math.random()*(i+1));
        [array[i],array[j]]=[array[j],array[i]];
    }
}

function getNames(){
    let names=[];
    for(let i=0;i<playerCount.value;i++){
        names.push(document.getElementById("name"+i)?.value||("Joueur "+(i+1)));
    }
    return names;
}

function generateNameInputs(){
    let count=parseInt(playerCount.value);
    let container=document.getElementById("nameInputs");
    container.innerHTML="";
    for(let i=0;i<count;i++){
        let input=document.createElement("input");
        input.id="name"+i;
        input.placeholder="Nom joueur "+(i+1);
        container.appendChild(input);
    }
    saveConfig();
}

function startGame(){
    saveConfig();

    let count=parseInt(playerCount.value);
    let impostors=parseInt(impostorCount.value);
    let idiot=idiotToggle.checked;

    if(count<4||impostors<1||impostors>=count){
        alert("Configuration invalide");
        return;
    }

    players=[];
    let pair=words[Math.floor(Math.random()*words.length)];
    villageWord=pair[0];
    impostorWord=pair[1];

    let names=getNames();

    for(let i=0;i<count;i++){
        players.push({
            name:names[i],
            role:"Villageois",
            word:villageWord,
            alive:true
        });
    }

    shuffle(players);

    for(let i=0;i<impostors;i++){
        players[i].role="Imposteur";
        players[i].word=impostorWord;
    }

    if(idiot){
        let villagers=players.filter(p=>p.role==="Villageois");
        let chosen=villagers[Math.floor(Math.random()*villagers.length)];
        chosen.role="Idiot du Royaume";
        chosen.word="";
    }

    shuffle(players);

    currentPlayer=0;
    setup.classList.add("hidden");
    transition.classList.remove("hidden");
    playerName.innerText=players[currentPlayer].name;
}

function showWord(){
    transition.classList.add("hidden");
    reveal.classList.remove("hidden");

    let player=players[currentPlayer];

    if(player.role==="Idiot du Royaume"){
        wordText.innerText="ü§° Tu es l'idiot du royaume ü§°";
    } else {
        wordText.innerText=player.word;
    }
}

function nextPlayer(){
    currentPlayer++;
    if(currentPlayer>=players.length){
        reveal.classList.add("hidden");
        startVote();
        return;
    }
    reveal.classList.add("hidden");
    transition.classList.remove("hidden");
    playerName.innerText=players[currentPlayer].name;
}

function startVote(){
    voteScreen.classList.remove("hidden");
    voteButtons.innerHTML="";
    players.forEach(p=>{
        if(p.alive){
            let btn=document.createElement("button");
            btn.className="playerButton";
            btn.innerText=p.name;
            btn.onclick=()=>eliminate(p);
            voteButtons.appendChild(btn);
        }
    });
}

function eliminate(player){
    player.alive=false;
    voteScreen.classList.add("hidden");
    resultScreen.classList.remove("hidden");
    resultScreen.innerHTML="<h3>"+player.name+" √©tait "+player.role+"</h3>";

    if(player.role==="Idiot du Royaume"){
        let guess=prompt("Quel est le mot des villageois ?");
        if(guess && guess.toLowerCase()===villageWord.toLowerCase()){
            resultScreen.innerHTML+="<h2>ü§° L'Idiot triomphe !</h2>";
            resultScreen.innerHTML+="<button onclick='location.reload()'>Nouvelle partie</button>";
            return;
        }
    }

    let impostorsAlive=players.filter(p=>p.role==="Imposteur"&&p.alive).length;
    let villagersAlive=players.filter(p=>p.role==="Villageois"&&p.alive).length;

    if(impostorsAlive===0){
        resultScreen.innerHTML+="<h2>üéâ Victoire des Villageois</h2>";
        resultScreen.innerHTML+="<button onclick='location.reload()'>Nouvelle partie</button>";
        return;
    }

    if(impostorsAlive>=villagersAlive){
        resultScreen.innerHTML+="<h2>üíÄ Victoire des Imposteurs</h2>";
        resultScreen.innerHTML+="<button onclick='location.reload()'>Nouvelle partie</button>";
        return;
    }

    resultScreen.innerHTML+="<button onclick='nextRound()'>Continuer</button>";
}

function nextRound(){
    resultScreen.classList.add("hidden");
    startVote();
}

function toggleRules(){
    rules.classList.toggle("hidden");
}

loadConfig();

</script>
</body>
</html>
