<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#2c1b12">
<title>L'Imposteur du Royaume</title>

<style>
body{
    margin:0;
    font-family: 'Segoe UI', sans-serif;
    color:white;
    text-align:center;
    background: linear-gradient(-45deg,#2c1b12,#1a1a1a,#3e2723,#1c1c1c);
    background-size:400% 400%;
    animation: gradientBG 15s ease infinite;
}

@keyframes gradientBG{
    0%{background-position:0% 50%;}
    50%{background-position:100% 50%;}
    100%{background-position:0% 50%;}
}

.container{
    max-width:500px;
    margin:auto;
    padding:20px;
}

.card{
    background:#2f2f2f;
    padding:20px;
    margin-top:20px;
    border-radius:20px;
    box-shadow:0 10px 30px rgba(0,0,0,0.6);
    animation:fadeIn 0.4s ease;
    transition:all 0.4s ease;
}

@keyframes fadeIn{
    from{opacity:0; transform:translateY(20px);}
    to{opacity:1; transform:translateY(0);}
}

.logo{
    font-size:28px;
    font-weight:bold;
    color:#f1c40f;
}

input{
    padding:10px;
    margin:5px;
    border-radius:10px;
    border:none;
    font-size:16px;
}

button{
    background:#8e44ad;
    border:none;
    padding:12px;
    margin:8px 0;
    width:100%;
    font-size:16px;
    border-radius:12px;
    color:white;
    cursor:pointer;
    -webkit-tap-highlight-color: transparent;
}

button:hover{ background:#9b59b6; }

.playerButton{background:#2980b9;}
.playerButton:hover{background:#3498db;}

.ruleBtn{background:#16a085;}
.resetBtn{background:#c0392b;}

.hidden{display:none;}
</style>
</head>

<body>

<div class="container">

<div class="logo">üëë L'Imposteur du Royaume</div>

<div id="setup" class="card">
<h3>Configuration</h3>
<input type="number" id="playerCount" min="4" placeholder="Nombre de joueurs">
<input type="number" id="impostorCount" min="1" placeholder="Nombre d'imposteurs">
<label><input type="checkbox" id="idiotToggle"> Ajouter un Idiot du Royaume</label>
<div id="nameInputs"></div>
<button onclick="generateNameInputs()">Valider joueurs</button>
<button onclick="startGame()">Lancer la partie</button>
<button class="ruleBtn" onclick="toggleRules()">R√®gles du jeu</button>
<button class="resetBtn" onclick="resetSettings()">R√©initialiser</button>
</div>

<div id="rules" class="card hidden">
<h3>üìú R√¥les</h3>
<p>
üë®‚Äçüåæ <b>Villageois</b> : Tous ont le m√™me mot et doivent √©liminer les imposteurs.<br><br>
üïµÔ∏è <b>Imposteur</b> : Ont un mot l√©g√®rement diff√©rent et doivent survivre.<br><br>
ü§° <b>Idiot du Royaume</b> : N‚Äôa aucun mot. Il doit deviner celui des villageois lorsqu‚Äôil est √©limin√©.<br><br>
Condition : Minimum 4 joueurs, minimum 1 imposteur, maximum 1 idiot.
</p>
</div>

<div id="transition" class="card hidden">
<h3>Passe le t√©l√©phone √†</h3>
<h2 id="playerName"></h2>
<button onclick="showWord()">Voir mon r√¥le</button>
</div>

<div id="reveal" class="card hidden">
<h2 id="wordText"></h2>
<button onclick="nextPlayer()">Cacher</button>
</div>

<div id="voteScreen" class="card hidden">
<h3>Votez un joueur</h3>
<div id="voteButtons"></div>
</div>

<div id="resultScreen" class="card hidden"></div>

</div>

<script>

let players=[];
let currentPlayer=0;
let villageWord="";
let impostorWord="";

const clickSound=new Audio("https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3");
const winSound=new Audio("https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3");

const words=[
["Chat","Tigre"],["Pizza","Burger"],
["Roi","Prince"],["Dragon","Dinosaure"],
["Plage","Piscine"],["Soleil","Lune"],
["Football","Basket"],["Vin","Bi√®re"]
];

function shuffle(array){
    for(let i=array.length-1;i>0;i--){
        let j=Math.floor(Math.random()*(i+1));
        [array[i],array[j]]=[array[j],array[i]];
    }
}

function getNames(){
    let names=[];
    for(let i=0;i<playerCount.value;i++){
        names.push(document.getElementById("name"+i)?.value||("Joueur "+(i+1)));
    }
    return names;
}

function generateNameInputs(){
    let count=parseInt(playerCount.value);
    let container=document.getElementById("nameInputs");
    container.innerHTML="";
    for(let i=0;i<count;i++){
        let input=document.createElement("input");
        input.id="name"+i;
        input.placeholder="Nom joueur "+(i+1);
        container.appendChild(input);
    }
}

function startGame(){
    clickSound.play();
    let count=parseInt(playerCount.value);
    let impostors=parseInt(impostorCount.value);
    let idiot=document.getElementById("idiotToggle").checked;

    if(count<4||impostors<1||impostors>=count){
        alert("Configuration invalide");
        return;
    }

    players=[];
    let pair=words[Math.floor(Math.random()*words.length)];
    villageWord=pair[0];
    impostorWord=pair[1];

    let names=getNames();

    for(let i=0;i<count;i++){
        players.push({
            name:names[i],
            role:"Villageois",
            word:villageWord,
            alive:true
        });
    }

    shuffle(players);

    for(let i=0;i<impostors;i++){
        players[i].role="Imposteur";
        players[i].word=impostorWord;
    }

    if(idiot){
        let villagers=players.filter(p=>p.role==="Villageois");
        let chosen=villagers[Math.floor(Math.random()*villagers.length)];
        chosen.role="Idiot du Royaume";
        chosen.word="";
    }

    shuffle(players);

    currentPlayer=0;
    setup.classList.add("hidden");
    transition.classList.remove("hidden");
    playerName.innerText=players[currentPlayer].name;
}

function showWord(){
    clickSound.play();
    transition.classList.add("hidden");
    reveal.classList.remove("hidden");

    let player=players[currentPlayer];

    if(player.role==="Idiot du Royaume"){
        wordText.innerText="ü§° Tu n'as aucun mot.";
    } else {
        wordText.innerText=player.word;
    }
}

function nextPlayer(){
    currentPlayer++;
    if(currentPlayer>=players.length){
        reveal.classList.add("hidden");
        startVote();
        return;
    }
    reveal.classList.add("hidden");
    transition.classList.remove("hidden");
    playerName.innerText=players[currentPlayer].name;
}

function startVote(){
    voteScreen.classList.remove("hidden");
    voteButtons.innerHTML="";
    players.forEach(p=>{
        if(p.alive){
            let btn=document.createElement("button");
            btn.className="playerButton";
            btn.innerText=p.name;
            btn.onclick=()=>eliminate(p);
            voteButtons.appendChild(btn);
        }
    });
}

function eliminate(player){
    clickSound.play();
    player.alive=false;
    voteScreen.classList.add("hidden");
    resultScreen.classList.remove("hidden");
    resultScreen.innerHTML="";

    let title=document.createElement("h3");
    title.innerText=player.name+" √©tait "+player.role;
    resultScreen.appendChild(title);

    if(player.role==="Idiot du Royaume"){
        let guess=prompt("Quel est le mot des villageois ?");
        if(guess && guess.toLowerCase()===villageWord.toLowerCase()){
            winSound.play();
            resultScreen.innerHTML+="<h2>ü§° L'Idiot gagne !</h2>";
            resultScreen.innerHTML+="<button onclick='location.reload()'>Nouvelle partie</button>";
            return;
        }
    }

    let impostorsAlive=players.filter(p=>p.role==="Imposteur"&&p.alive).length;
    let villagersAlive=players.filter(p=>p.role==="Villageois"&&p.alive).length;

    if(impostorsAlive===0){
        winSound.play();
        resultScreen.innerHTML+="<h2>üéâ Victoire des villageois</h2>";
        resultScreen.innerHTML+="<button onclick='location.reload()'>Nouvelle partie</button>";
        return;
    }

    if(impostorsAlive>=villagersAlive){
        winSound.play();
        resultScreen.innerHTML+="<h2>üíÄ Victoire des imposteurs</h2>";
        resultScreen.innerHTML+="<button onclick='location.reload()'>Nouvelle partie</button>";
        return;
    }

    resultScreen.innerHTML+="<button onclick='nextRound()'>Continuer</button>";
}

function nextRound(){
    resultScreen.classList.add("hidden");
    startVote();
}

function toggleRules(){
    rules.classList.toggle("hidden");
}

function resetSettings(){
    location.reload();
}

</script>
</body>
</html>
