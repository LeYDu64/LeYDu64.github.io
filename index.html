<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>L'Imposteur du Royaume</title>

<style>
body{
    margin:0;
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg,#2c1b12,#1a1a1a);
    color:white;
    text-align:center;
    overflow-x:hidden;
}

.container{
    max-width:500px;
    margin:auto;
    padding:20px;
}

.card{
    background:#2f2f2f;
    padding:20px;
    margin-top:20px;
    border-radius:20px;
    box-shadow:0 10px 30px rgba(0,0,0,0.6);
    transform: scale(0.9);
    opacity:0;
    transition: transform 0.5s, opacity 0.5s;
}

.card.show{
    transform: scale(1);
    opacity:1;
}

.logo{
    font-size:28px;
    font-weight:bold;
    color:#f1c40f;
}

input{
    padding:10px;
    margin:5px;
    border-radius:10px;
    border:none;
    font-size:16px;
}

button{
    background:#8e44ad;
    border:none;
    padding:12px;
    margin:8px 0;
    width:100%;
    font-size:16px;
    border-radius:12px;
    color:white;
    cursor:pointer;
    transition: transform 0.2s, background 0.2s;
}

button:hover{
    background:#9b59b6;
    transform: scale(1.05);
}

.hidden{display:none;}

.playerButton{background:#2980b9;}
.playerButton:hover{background:#3498db;}

.ruleBtn{background:#16a085;}
.resetBtn{background:#c0392b;}

#music{
    display:none;
}

</style>
</head>

<body>

<audio id="music" loop>
  <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
</audio>

<audio id="clickSound">
  <source src="https://freesound.org/data/previews/256/256113_3263906-lq.mp3" type="audio/mpeg">
</audio>

<div class="container">

<div class="logo">ðŸ‘‘ L'Imposteur du Royaume</div>

<div id="setup" class="card show">
<h3>Configuration</h3>
<input type="number" id="playerCount" min="4" placeholder="Nombre de joueurs">
<input type="number" id="impostorCount" min="1" placeholder="Nombre d'imposteurs">
<div>
<label>
<input type="checkbox" id="idiotCheck"> Ajouter l'Idiot du Royaume
</label>
</div>
<div id="nameInputs"></div>
<button onclick="generateNameInputs()">Valider joueurs</button>
<button onclick="startGame()">Lancer la partie</button>
<button class="ruleBtn" onclick="toggleRules()">RÃ¨gles du jeu</button>
<button class="resetBtn" onclick="resetSettings()">RÃ©initialiser</button>
</div>

<div id="rules" class="card hidden">
<h3>ðŸ“œ RÃ¨gles</h3>
<p><strong>Villageois :</strong> reÃ§oit un mot et doit le dÃ©crire.<br>
<strong>Imposteur :</strong> reÃ§oit un mot diffÃ©rent proche, doit tromper les villageois.<br>
<strong>Idiot du Royaume :</strong> nâ€™a pas de mot, son but est de deviner le mot des villageois.<br><br>
Chaque joueur dÃ©crit son mot (ou cherche Ã  deviner pour lâ€™Idiot) Ã  voix haute.<br>
Votez ensuite pour Ã©liminer un joueur.<br>
Victoire :<br>
- Tous les imposteurs Ã©liminÃ©s â†’ villageois gagnent<br>
- Imposteurs â‰¥ villageois encore en vie â†’ imposteurs gagnent</p>
</div>

<div id="transition" class="card hidden">
<h3>Passe le tÃ©lÃ©phone Ã </h3>
<h2 id="playerName"></h2>
<button onclick="showWord()">Voir mon mot</button>
</div>

<div id="reveal" class="card hidden">
<h2 id="wordText"></h2>
<button onclick="nextPlayer()">Cacher</button>
</div>

<div id="voteScreen" class="card hidden">
<h3>Votez un joueur</h3>
<div id="voteButtons"></div>
</div>

<div id="resultScreen" class="card hidden"></div>

</div>

<script>

// -------- VARIABLES --------
let players=[];
let currentPlayer=0;

const words=[
["Chat","Tigre"],["Pizza","Burger"],["Roi","Prince"],["Dragon","Dinosaure"],
["Plage","Piscine"],["Soleil","Lune"],["Football","Basket"],["Vin","BiÃ¨re"]
];

const setup=document.getElementById("setup");
const transition=document.getElementById("transition");
const reveal=document.getElementById("reveal");
const voteScreen=document.getElementById("voteScreen");
const voteButtons=document.getElementById("voteButtons");
const resultScreen=document.getElementById("resultScreen");
const playerName=document.getElementById("playerName");
const rules=document.getElementById("rules");

const music=document.getElementById("music");
const clickSound=document.getElementById("clickSound");

// -------- SAUVEGARDE --------
function saveSettings(){
    localStorage.setItem("gameSettings",JSON.stringify({
        playerCount:playerCount.value,
        impostorCount:impostorCount.value,
        idiot:document.getElementById("idiotCheck").checked,
        names:getNames()
    }));
}

function loadSettings(){
    let data=JSON.parse(localStorage.getItem("gameSettings"));
    if(!data)return;
    playerCount.value=data.playerCount;
    impostorCount.value=data.impostorCount;
    document.getElementById("idiotCheck").checked=data.idiot;
    generateNameInputs();
    setTimeout(()=>{
        data.names.forEach((name,i)=>{
            document.getElementById("name"+i).value=name;
        });
    },100);
}

function resetSettings(){
    localStorage.removeItem("gameSettings");
    location.reload();
}

function getNames(){
    let names=[];
    for(let i=0;i<playerCount.value;i++){
        names.push(document.getElementById("name"+i)?.value||("Joueur "+(i+1)));
    }
    return names;
}

function generateNameInputs(){
    let count=parseInt(playerCount.value);
    let container=document.getElementById("nameInputs");
    container.innerHTML="";
    for(let i=0;i<count;i++){
        container.innerHTML+=`<input id="name${i}" placeholder="Nom joueur ${i+1}">`;
    }
    saveSettings();
}

// -------- DÃ‰BUT DU JEU --------
function startGame(){
    clickSound.play();
    let count=parseInt(playerCount.value);
    let impostors=parseInt(impostorCount.value);
    let idiotEnabled=document.getElementById("idiotCheck").checked;
    if(count<4||impostors<1||impostors>=count){
        alert("Configuration invalide"); return;
    }
    if(idiotEnabled && count<impostors+2){
        alert("Trop peu de joueurs pour ajouter l'Idiot"); return;
    }

    saveSettings();
    players=[];
    let pair=words[Math.floor(Math.random()*words.length)];
    let names=getNames();

    // DISTRIBUTION DES RÃ”LES
    for(let i=0;i<count;i++){
        players.push({
            name:names[i],
            role:"Villageois",
            word:pair[0],
            alive:true
        });
    }

    // Ajout des imposteurs
    let impostorCount=impostors;
    players.sort(()=>Math.random()-0.5);
    for(let i=0;i<impostorCount;i++){
        players[i].role="Imposteur";
        players[i].word=pair[1];
    }

    // Ajout de l'Idiot
    if(idiotEnabled){
        let candidates=players.filter(p=>p.role==="Villageois");
        let random=candidates[Math.floor(Math.random()*candidates.length)];
        random.role="Idiot du Royaume";
        random.word="???";
    }

    players.sort(()=>Math.random()-0.5);
    currentPlayer=0;

    setup.classList.remove("show");
    setup.classList.add("hidden");
    transition.classList.add("show");
    transition.classList.remove("hidden");
    playerName.innerText=players[currentPlayer].name;

    // Lancer musique
    music.volume=0.3;
    music.play();
}

function showWord(){
    clickSound.play();
    transition.classList.remove("show");
    transition.classList.add("hidden");
    reveal.classList.add("show");
    reveal.classList.remove("hidden");
    wordText.innerText=players[currentPlayer].word;
}

function nextPlayer(){
    clickSound.play();
    currentPlayer++;
    if(currentPlayer>=players.length){
        reveal.classList.remove("show");
        reveal.classList.add("hidden");
        startVote();
        return;
    }
    reveal.classList.remove("show");
    reveal.classList.add("hidden");
    transition.classList.add("show");
    transition.classList.remove("hidden");
    playerName.innerText=players[currentPlayer].name;
}

// -------- VOTE --------
function startVote(){
    voteScreen.classList.add("show");
    voteScreen.classList.remove("hidden");
    voteButtons.innerHTML="";
    players.forEach(p=>{
        if(p.alive){
            let btn=document.createElement("button");
            btn.className="playerButton";
            btn.innerText=p.name;
            btn.onclick=()=>eliminate(p);
            voteButtons.appendChild(btn);
        }
    });
}

function eliminate(player){
    clickSound.play();
    player.alive=false;
    voteScreen.classList.remove("show");
    voteScreen.classList.add("hidden");

    let impostorsAlive=players.filter(p=>p.role==="Imposteur"&&p.alive).length;
    let villagersAlive=players.filter(p=>p.role==="Villageois"&&p.alive).length;

    resultScreen.classList.add("show");
    resultScreen.classList.remove("hidden");
    resultScreen.innerHTML=`<h3>${player.name} Ã©tait ${player.role}</h3>`;

    if(impostorsAlive===0){
        resultScreen.innerHTML+=`<h2>ðŸŽ‰ Victoire des villageois</h2>
        <button onclick="location.reload()">Nouvelle partie</button>`;
        return;
    }

    if(impostorsAlive>=villagersAlive){
        resultScreen.innerHTML+=`<h2>ðŸ’€ Victoire des imposteurs</h2>
        <button onclick="location.reload()">Nouvelle partie</button>`;
        return;
    }

    resultScreen.innerHTML+=`<button onclick="nextRound()">Continuer</button>`;
}

function nextRound(){
    clickSound.play();
    resultScreen.classList.remove("show");
    resultScreen.classList.add("hidden");
    startVote();
}

function toggleRules(){
    clickSound.play();
    rules.classList.toggle("hidden");
}

loadSettings();

</script>
</body>
</html>
